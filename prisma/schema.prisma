generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum PreferenceCategory {
  ACCESSIBILITY
  CUSTOMIZATION
  NOTIFICATION
  SECURITY
  PRIVACY
  ACCOUNT
  ACTIVITY
  DATA_OWNERSHIP
}

model User {
  id              String           @id @db.VarChar(12)
  firstName       String
  lastName        String
  email           String           @unique
  password        String
  phone           String?
  role            Roles            @default(USER)
  isActive        Boolean          @default(true)
  isEmailVerified Boolean          @default(false)
  userPreferences UserPreferences?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  isArchived      ArchivedUsers[]  @relation("ArchivedUserRelation")
}

model ArchivedUsers {
  id         String   @id @db.VarChar(12)
  userId     String   @unique
  archivedAt DateTime @default(now())
  user       User     @relation("ArchivedUserRelation", fields: [userId], references: [id])
}

model UserPreferences {
  id                     String                    @id @db.VarChar(12)
  userId                 String                    @unique
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  user                   User                      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessibilitySettings  AccessibilitySettings?
  customizationSettings  CustomizationSettings?
  notificationSettings   UserNotificationSettings?
  securitySettings       UserSecuritySettings?
  privacySettings        PrivacySettings?
  accountControl         AccountControlSettings?
  dataOwnership          DataOwnershipSettings?
  activeSessions         ActiveSession[]
  trustedDevices         TrustedDevice[]
  activityLogs           ActivityLog[]
  loginHistory           LoginHistory[]
  preferenceAuditLogs    PreferenceAuditLog[]
}

model UserNotificationSettings {
  id                 String          @id @db.VarChar(12)
  userPreferencesId  String          @unique
  emailNotifications Boolean         @default(true)
  pushNotifications  Boolean         @default(false)
  smsNotifications   Boolean         @default(false)
  preferences        Json            @default("{}")
  emailByCategory    Json            @default("{}")
  pushByCategory     Json            @default("{}")
  smsAlerts          Json            @default("{}")
  quietHoursStart    String?
  quietHoursEnd      String?
  marketingOptIn     Boolean         @default(false)
  digestFrequency    String          @default("daily")
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  userPreferences    UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
}

model AccessibilitySettings {
  id                       String          @id @db.VarChar(12)
  userPreferencesId        String          @unique
  language                 String          @default("en")
  timezone                 String          @default("UTC")
  dateFormat               String          @default("MM/DD/YYYY")
  numberFormat             String          @default("1,000.00")
  currency                 String          @default("USD")
  timeFormat               String          @default("12h")
  highContrastMode         Boolean         @default(false)
  reducedMotion            Boolean         @default(false)
  screenReaderOptimized    Boolean         @default(false)
  fontSize                 String          @default("medium")
  keyboardNavigation       Boolean         @default(false)
  colorBlindMode           String?
  createdAt                DateTime        @default(now())
  updatedAt                DateTime        @updatedAt
  userPreferences          UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
}

model CustomizationSettings {
  id                       String          @id @db.VarChar(12)
  userPreferencesId        String          @unique
  theme                    String          @default("system")
  layoutPreferences        Json            @default("{}")
  defaultViews             Json            @default("{}")
  sortFilterDefaults       Json            @default("{}")
  paginationSize           Int             @default(10)
  featureToggles           Json            @default("{}")
  betaFeaturesOptIn        Boolean         @default(false)
  aiFeaturesOptIn          Boolean         @default(false)
  contentSensitivityFilters Json           @default("{}")
  sidebarCollapsed         Boolean         @default(false)
  compactMode              Boolean         @default(false)
  createdAt                DateTime        @default(now())
  updatedAt                DateTime        @updatedAt
  userPreferences          UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
}

model AccountControlSettings {
  id                  String          @id @db.VarChar(12)
  userPreferencesId   String          @unique
  deactivated         Boolean         @default(false)
  deactivatedAt       DateTime?
  deletionRequested   Boolean         @default(false)
  deletionRequestedAt DateTime?
  recoveryToken       String?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt
  userPreferences     UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
}

model ActiveSession {
  id                String          @id @db.VarChar(12)
  userPreferencesId String
  sessionId         String
  ipAddress         String?
  userAgent         String?
  lastSeen          DateTime        @default(now())
  createdAt         DateTime        @default(now())
  userPreferences   UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)

  @@index([userPreferencesId])
  @@index([lastSeen])
}

model TrustedDevice {
  id                String          @id @db.VarChar(12)
  userPreferencesId String
  deviceId          String
  deviceName        String?
  lastUsed          DateTime        @default(now())
  createdAt         DateTime        @default(now())
  userPreferences   UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)

  @@index([userPreferencesId])
}

model UserSecuritySettings {
  id                String             @id @db.VarChar(12)
  userPreferencesId String             @unique
  twoFactorEnabled  Boolean            @default(false)
  twoFactorMethod   String?
  passwordChangedAt DateTime?
  activeSessions    Json               @default("[]")
  trustedDevices    Json               @default("[]")
  passkeysEnabled   Boolean            @default(false)
  ipRestrictions    Json               @default("[]")
  loginAlerts       Json               @default("{}")
  suspiciousActivityAlerts Json         @default("{}")
  backupCodes       Json               @default("[]")
  sessionExpiration Int                @default(3600)
  passwordRotationReminder Int          @default(90)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  userPreferences   UserPreferences    @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
  securityAuditLogs SecurityAuditLog[]
}

model PreferenceAuditLog {
  id                String          @id @db.VarChar(12)
  userPreferencesId String
  category          String
  field             String
  oldValue          Json?
  newValue          Json
  changedBy         String
  changeReason      String?
  createdAt         DateTime        @default(now())
  userPreferences   UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)

  @@index([userPreferencesId])
  @@index([createdAt])
}

model SecurityAuditLog {
  id                 String               @id @db.VarChar(12)
  securitySettingsId String
  event              String
  details            Json
  ipAddress          String?
  userAgent          String?
  createdAt          DateTime             @default(now())
  securitySettings   UserSecuritySettings @relation(fields: [securitySettingsId], references: [id], onDelete: Cascade)

  @@index([securitySettingsId])
  @@index([createdAt])
}

model ActivityLog {
  id                String          @id @db.VarChar(12)
  userPreferencesId String
  activityType      String
  action            String
  details           Json
  ipAddress         String?
  userAgent         String?
  timestamp         DateTime        @default(now())
  userPreferences   UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)

  @@index([userPreferencesId])
  @@index([timestamp])
}

model LoginHistory {
  id                String          @id @db.VarChar(12)
  userPreferencesId String
  ipAddress         String?
  userAgent         String?
  deviceName        String?
  loginMethod       String?
  loginAt           DateTime        @default(now())
  logoutAt          DateTime?
  duration          Int?
  userPreferences   UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)

  @@index([userPreferencesId])
  @@index([loginAt])
}

model DataOwnershipSettings {
  id                   String          @id @db.VarChar(12)
  userPreferencesId    String          @unique
  exportFormat         String          @default("json")
  dataRetentionDays    Int             @default(365)
  allowAutoDelete      Boolean         @default(false)
  allowDataAnonymization Boolean       @default(false)
  dataExportRequests   Json            @default("[]")
  dataDeletionRequests Json            @default("[]")
  dataCorrections      Json            @default("[]")
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  userPreferences      UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
}

model PrivacySettings {
  id                     String          @id @db.VarChar(12)
  userPreferencesId      String          @unique
  profileVisibility      String          @default("private")
  activityVisibility     Json            @default("{}")
  fieldLevelVisibility   Json            @default("{}")
  onlinePresence         String          @default("hidden")
  allowPublicProfile     Boolean         @default(false)
  allowSearchEngineIndex Boolean         @default(false)
  allowThirdPartySharing Boolean         @default(false)
  dataShareConsent       Boolean         @default(false)
  dataRetentionMonths    Int             @default(12)
  auditLogPreference     String          @default("full")
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  userPreferences        UserPreferences @relation(fields: [userPreferencesId], references: [id], onDelete: Cascade)
}

enum Roles {
  ADMIN
  USER
}
